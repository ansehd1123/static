<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>XSS 확인</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .section {
            flex: 1;
        }
        textarea {
            width: 100%;
            height: 260px;
            padding: 10px;
            box-sizing: border-box;
            font-family: Consolas, Menlo, monospace;
            font-size: 13px;
        }
        button {
            margin-top: 10px;
            padding: 6px 12px;
            cursor: pointer;
        }
        h3 {
            margin-bottom: 5px;
        }
        .small {
            font-size: 12px;
            color: #666;
        }
        .inline {
            display: inline-block;
            margin-left: 6px;
            font-size: 12px;
            color: #444;
        }
        .list-box {
            height: 80px;
        }
    </style>
</head>
<body>
    <h2>HTML 내 testtest[숫자] → [name]=testtest[숫자]";'; 매핑 생성</h2>

    <!-- ✅ 기준 쿼리 두 개를 좌우로 배치 -->
<div class="container">
    <div class="section">
        <h3>응답 HTML <span class="inline"></span></h3>
        <textarea id="baseHTML"></textarea>

        <!-- ⬇⬇ 추가된 버튼 ⬇⬇ -->
        <button id="chkPam">파라미터 확인</button>

    </div>

    <div class="section">
        <h3>파라미터 <span class="inline"></span></h3>
        <textarea id="baseQuery">test=testtest1</textarea>
    </div>
</div>

    <!-- ✅ 아래 영역은 그대로: HTML 입력 / 결과 -->
    <div class="container">
        <div class="section">
            <h3>HTML 소스 입력</h3>
            <textarea id="htmlInput" placeholder="여기에 사용자가 입력하는 HTML 소스 코드를 넣으세요."></textarea>
            <button id="runBtn">변환 실행</button>
            <div class="small">
                - HTML 안에서 <code>testtest[숫자]</code> 패턴을 모두 찾습니다.<br>
                - 기준 쿼리 문자열에서 값이 일치하는 파라미터 이름을 찾아 매핑을 만듭니다.
            </div>
        </div>

        <div class="section">
            <h3>추출된 testtest 목록</h3>
            <textarea id="foundList" class="list-box" readonly></textarea>

            <h3>결과 파라미터 문자열</h3>
            <textarea id="result" readonly placeholder="[name]=testtest1&quot;&gt;';&[다음파라미터]=testtest2&quot;&gt;'; ..."></textarea>
        </div>
    </div>

    <script>
        // 기준 쿼리 문자열을 파싱하여 { 값(testtestN): [파라미터이름들...] } 매핑 생성
        function buildValueToNamesMap(query) {
            const params = new URLSearchParams(query.trim());
            const map = new Map(); // value -> [names]

            for (const [name, value] of params.entries()) {
                if (!map.has(value)) {
                    map.set(value, []);
                }
                map.get(value).push(name);
            }
            return map;
        }

        // HTML 문자열에서 testtest[숫자] 패턴 추출 (중복 제거)
        function extractTesttestValues(html) {
            const regex = /testtest(\d+)/g;
            const set = new Set();
            let match;
            while ((match = regex.exec(html)) !== null) {
                set.add(`testtest${match[1]}`);
            }
            return Array.from(set);
        }

        document.getElementById('runBtn').addEventListener('click', function () {
            const baseQuery = document.getElementById('baseQuery').value;
            const html = document.getElementById('htmlInput').value;

            const valueToNames = buildValueToNamesMap(baseQuery);
            const testValues = extractTesttestValues(html);

            // 추출된 testtest 목록 표시
            const foundListArea = document.getElementById('foundList');
            if (testValues.length === 0) {
                foundListArea.value = 'HTML에서 testtest[숫자] 패턴을 찾지 못했습니다.';
            } else {
                foundListArea.value = testValues.join('\n');
            }

            const resultParts = [];

            // 각 testtestN에 대해 기준 쿼리에서 이름 찾고 결과 문자열 구성
            for (const value of testValues) {
                const names = valueToNames.get(value);
                if (!names || names.length === 0) {
                    // 기준 쿼리에서 해당 값을 가진 파라미터가 없으면 스킵
                    continue;
                }

                for (const name of names) {
                    // 여기서 원하는 최종 형식: name=testtestN">';
                    const part = `${name}=${value}">';`;
                    resultParts.push(part);
                }
            }

            const resultArea = document.getElementById('result');
            if (resultParts.length === 0) {
                resultArea.value = '기준 쿼리 문자열에서 일치하는 파라미터를 찾지 못했습니다.';
            } else {
                // 여러 개는 &로 묶기
                resultArea.value = resultParts.join('&');
            }
        });
		document.getElementById('chkPam').addEventListener('click',
		function showFormattedNames() {
            const baseHTML = document.getElementById("baseHTML").value;

            // HTML 파싱
            const parser = new DOMParser();
            const doc = parser.parseFromString(baseHTML, 'text/html');

            // name 속성이 존재하는 모든 태그 추출
            const rawNames = Array.from(doc.querySelectorAll('[name]'))
                .map(el => el.getAttribute('name'));

            // 중복 제거
            const uniqueNames = [...new Set(rawNames)];

            // 번호 자동 증가 (test1, test2, test3...)
            const formattedOutput = uniqueNames
                .map((name, index) => `${name}=testtest${index + 1}`)
                .join('&');

            document.getElementById("baseQuery").value = formattedOutput;
        });
    </script>
</body>
</html>